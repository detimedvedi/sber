2025-11-04 02:18:16 - __main__ - INFO - Logging configured
2025-11-04 02:18:16 - __main__ - INFO - Starting anomaly detection pipeline
2025-11-04 02:18:16 - __main__ - INFO - Configuration loaded from config.yaml
2025-11-04 02:18:23 - __main__ - INFO - All components imported successfully
2025-11-04 02:18:23 - __main__ - INFO - ================================================================================
2025-11-04 02:18:23 - __main__ - INFO - Step 1: Loading data...
2025-11-04 02:18:23 - src.data_loader - INFO - DataLoader initialized with base path: .
2025-11-04 02:18:23 - src.data_loader - INFO - Loading СберИндекс data...
2025-11-04 02:18:24 - src.data_loader - INFO - Loaded connection: 4761495 rows, 4 columns
2025-11-04 02:18:24 - src.data_loader - INFO - Loaded consumption: 303126 rows, 4 columns
2025-11-04 02:18:24 - src.data_loader - INFO - Loaded market_access: 2571 rows, 2 columns
2025-11-04 02:18:24 - __main__ - INFO - СберИндекс data loaded successfully
2025-11-04 02:18:24 - src.data_loader - INFO - Loading Росстат data...
2025-11-04 02:18:24 - src.data_loader - INFO - Loaded population: 700215 rows, 6 columns
2025-11-04 02:18:24 - src.data_loader - INFO - Loaded migration: 106224 rows, 6 columns
2025-11-04 02:18:24 - src.data_loader - INFO - Loaded salary: 369812 rows, 6 columns
2025-11-04 02:18:24 - __main__ - INFO - Росстат data loaded successfully
2025-11-04 02:18:24 - src.data_loader - INFO - Loading municipal dictionary...
2025-11-04 02:18:24 - src.data_loader - INFO - Loaded municipal dictionary: 3101 rows, 18 columns
2025-11-04 02:18:24 - __main__ - INFO - Municipal dictionary loaded
2025-11-04 02:18:24 - src.data_loader - INFO - Merging datasets...
2025-11-04 02:18:24 - src.data_loader - INFO - Starting with 3101 municipalities from dictionary
2025-11-04 02:18:24 - src.data_loader - INFO - Merged consumption data: 6 categories
2025-11-04 02:18:24 - src.data_loader - INFO - Merged market access data
2025-11-04 02:18:25 - src.data_loader - INFO - Merged population data
2025-11-04 02:18:25 - src.data_loader - INFO - Merged migration data
2025-11-04 02:18:25 - src.data_loader - INFO - Merged salary data: 21 industries
2025-11-04 02:18:25 - src.data_loader - INFO - Final merged dataset: 3101 rows, 36 columns
2025-11-04 02:18:25 - src.data_loader - INFO - Validating data quality...
2025-11-04 02:18:25 - src.data_loader - WARNING - Found missing values in 32 columns
2025-11-04 02:18:25 - src.data_loader - WARNING -   salary_Деятельность экстер. организаций: 3095 missing values (99.8%)
2025-11-04 02:18:25 - src.data_loader - WARNING -   salary_Добыча полезных ископаемых: 2139 missing values (69.0%)
2025-11-04 02:18:25 - src.data_loader - WARNING -   salary_Прочие услуги: 1337 missing values (43.1%)
2025-11-04 02:18:25 - src.data_loader - WARNING -   salary_Гостиницы и общепит: 979 missing values (31.6%)
2025-11-04 02:18:25 - src.data_loader - WARNING -   salary_Строительство: 961 missing values (31.0%)
2025-11-04 02:18:25 - src.data_loader - WARNING -   salary_Операции с недвижимостью: 793 missing values (25.6%)
2025-11-04 02:18:25 - src.data_loader - WARNING -   salary_Водоснабжение: 684 missing values (22.1%)
2025-11-04 02:18:25 - src.data_loader - WARNING -   salary_Обрабатывающие производства: 634 missing values (20.4%)
2025-11-04 02:18:25 - src.data_loader - WARNING -   salary_Сельское хозяйство: 598 missing values (19.3%)
2025-11-04 02:18:25 - src.data_loader - WARNING -   consumption_Все категории: 495 missing values (16.0%)
2025-11-04 02:18:25 - src.data_loader - WARNING - Found 2 columns with >50% missing values - consider excluding from analysis
2025-11-04 02:18:25 - src.data_loader - WARNING - Found 438 duplicate territory_ids
2025-11-04 02:18:25 - src.data_loader - INFO - Average data completeness: 83.67%
2025-11-04 02:18:25 - src.data_loader - WARNING - Found 105 municipalities with <50% data completeness
2025-11-04 02:18:25 - src.data_loader - INFO - Validation complete: 3101 rows, 36 columns, 84.12% overall completeness
2025-11-04 02:18:25 - src.data_loader - INFO - Creating source mapping for 36 columns...
2025-11-04 02:18:25 - src.data_loader - INFO - Source mapping complete: {'municipal_dict': 4, 'sberindex': 7, 'rosstat': 25}
2025-11-04 02:18:25 - __main__ - INFO - Created source mapping for columns
2025-11-04 02:18:25 - src.data_loader - INFO - Detecting duplicate territory_ids...
2025-11-04 02:18:25 - src.data_loader - WARNING - Found 879 duplicate territory_id entries affecting 438 territories
2025-11-04 02:18:25 - src.data_loader - INFO - Analyzing temporal structure...
2025-11-04 02:18:25 - src.data_loader - INFO - Periods per territory - Min: 1, Max: 3, Avg: 1.2
2025-11-04 02:18:25 - src.data_loader - INFO - Found 438 territories with multiple time periods
2025-11-04 02:18:25 - src.data_loader - INFO - No temporal structure detected in dataset
2025-11-04 02:18:25 - src.data_loader - INFO - Duplicate analysis (sample): 0 identical, 20 different
2025-11-04 02:18:25 - src.data_loader - WARNING - Duplicates have different values without temporal structure - investigate data quality
2025-11-04 02:18:25 - src.data_loader - INFO - Duplicate detection complete: is_temporal=False, recommendation='investigate'
2025-11-04 02:18:25 - __main__ - WARNING - DATA QUALITY WARNING: Found 879 duplicate territory_id entries
2025-11-04 02:18:25 - __main__ - WARNING - DATA QUALITY WARNING: Missing values detected in 32 columns
2025-11-04 02:18:25 - __main__ - INFO - Data merged successfully
2025-11-04 02:18:25 - __main__ - INFO - ================================================================================
2025-11-04 02:18:25 - __main__ - INFO - Step 2: Running anomaly detectors...
2025-11-04 02:18:25 - __main__ - INFO - Auto-tuning is enabled - running threshold optimization before detection
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - AutoTuner initialized: target_fpr=0.05, strategy=adaptive
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - Checking if periodic re-tuning is needed
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - Starting periodic re-tuning: No previous tuning history found
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - Starting threshold optimization with strategy: adaptive
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - Optimal threshold: 2.000 (target_fpr=0.050, achieved_fpr=0.048)
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - Statistical thresholds optimized: FPR 0.014 -> 0.048
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - Geographic thresholds optimized: FPR 0.000 -> 0.000
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - Temporal thresholds optimized: FPR 0.020 -> 0.016
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - Cross-source thresholds optimized: FPR 0.030 -> 0.022
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - Tuning history persisted to output\tuning_history.json (1 entries)
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - Tuning results saved: 1181 -> 3920 anomalies, FPR 0.016 -> 0.022
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - Threshold optimization completed
2025-11-04 02:18:25 - src.auto_tuner.AutoTuner - INFO - Re-tuning completed successfully: No previous tuning history found
2025-11-04 02:18:25 - __main__ - INFO - Auto-tuning completed: Re-tuning completed successfully: No previous tuning history found
2025-11-04 02:18:25 - __main__ - INFO - Tuned thresholds applied:
2025-11-04 02:18:25 - __main__ - INFO -   statistical: {'z_score': 2.0, 'iqr_multiplier': 1.0, 'percentile_lower': 1, 'percentile_upper': 99}
2025-11-04 02:18:25 - __main__ - INFO -   geographic: {'regional_z_score': 3.8500000000000005, 'cluster_threshold': 4.4}
2025-11-04 02:18:25 - __main__ - INFO -   temporal: {'spike_threshold': 110.00000000000001, 'drop_threshold': -55.00000000000001, 'volatility_multiplier': 2.1}
2025-11-04 02:18:25 - __main__ - INFO -   cross_source: {'correlation_threshold': 0.475, 'discrepancy_threshold': 55.00000000000001}
2025-11-04 02:18:25 - __main__ - INFO - Tuned configuration exported to output/tuned_thresholds.yaml
2025-11-04 02:18:25 - __main__ - INFO - Auto-tuning report generated: output\auto_tuning_report.md
2025-11-04 02:18:25 - src.detector_manager.ThresholdManager - INFO - Profile 'relaxed' loaded and validated successfully
2025-11-04 02:18:25 - src.detector_manager.ThresholdManager - INFO - ThresholdManager initialized with profile: relaxed
2025-11-04 02:18:25 - src.detector_manager.DetectorManager - INFO - DetectorManager initialized with 5 detectors using profile 'relaxed'
2025-11-04 02:18:25 - src.detector_manager.DetectorManager - INFO - ================================================================================
2025-11-04 02:18:25 - src.detector_manager.DetectorManager - INFO - Starting detector execution
2025-11-04 02:18:25 - src.detector_manager.DetectorManager - INFO - Input data shape: (3101, 36)
2025-11-04 02:18:25 - src.detector_manager.DetectorManager - INFO - ================================================================================
2025-11-04 02:18:25 - src.detector_manager.DetectorManager - INFO - Running statistical detector...
2025-11-04 02:18:25 - src.anomaly_detector.StatisticalOutlierDetector - INFO - Starting statistical outlier detection
2025-11-04 02:18:25 - src.anomaly_detector.StatisticalOutlierDetector - INFO - Z-score method detected 700 anomalies
2025-11-04 02:18:25 - src.anomaly_detector.StatisticalOutlierDetector - INFO - IQR method detected 4737 anomalies
2025-11-04 02:18:26 - src.anomaly_detector.StatisticalOutlierDetector - INFO - Percentile method detected 849 anomalies
2025-11-04 02:18:26 - src.anomaly_detector.StatisticalOutlierDetector - INFO - Total unique statistical outliers detected: 5898
2025-11-04 02:18:26 - src.detector_manager.DetectorManager - INFO - ✓ statistical completed successfully: 5898 anomalies detected in 0.66s
2025-11-04 02:18:26 - src.detector_manager.DetectorManager - INFO - Running cross_source detector...
2025-11-04 02:18:26 - src.anomaly_detector.CrossSourceComparator - INFO - Starting cross-source comparison detection
2025-11-04 02:18:26 - src.anomaly_detector.CrossSourceComparator - WARNING - Low correlation (0.156) between market_access and population_total
2025-11-04 02:18:26 - src.anomaly_detector.CrossSourceComparator - INFO - Calculated correlations for 1 indicator pairs
2025-11-04 02:18:26 - src.anomaly_detector.CrossSourceComparator - INFO - Detected 2843 large discrepancies
2025-11-04 02:18:26 - src.anomaly_detector.CrossSourceComparator - INFO - Total cross-source anomalies detected: 2843
2025-11-04 02:18:26 - src.detector_manager.DetectorManager - INFO - ✓ cross_source completed successfully: 2843 anomalies detected in 0.10s
2025-11-04 02:18:26 - src.detector_manager.DetectorManager - INFO - Running temporal detector...
2025-11-04 02:18:26 - src.anomaly_detector.TemporalAnomalyDetector - INFO - Starting temporal anomaly detection
2025-11-04 02:18:31 - src.anomaly_detector.TemporalAnomalyDetector - INFO - Detected 0 sudden spikes
2025-11-04 02:18:31 - src.anomaly_detector.TemporalAnomalyDetector - INFO - Detected 0 trend reversals
2025-11-04 02:18:32 - src.anomaly_detector.TemporalAnomalyDetector - INFO - Detected 0 high volatility cases
2025-11-04 02:18:32 - src.anomaly_detector.TemporalAnomalyDetector - INFO - Detected 0 seasonal anomalies
2025-11-04 02:18:32 - src.anomaly_detector.TemporalAnomalyDetector - INFO - No temporal anomalies detected
2025-11-04 02:18:32 - src.detector_manager.DetectorManager - INFO - ✓ temporal completed successfully: 0 anomalies detected in 6.45s
2025-11-04 02:18:32 - src.detector_manager.DetectorManager - INFO - Running geographic detector...
2025-11-04 02:18:32 - src.anomaly_detector.GeographicAnomalyDetector - INFO - Starting geographic anomaly detection
2025-11-04 02:18:32 - src.anomaly_detector.GeographicAnomalyDetector - WARNING - No municipality_type column - falling back to region-only grouping
2025-11-04 02:18:34 - src.anomaly_detector.GeographicAnomalyDetector - INFO - Detected 1310 regional outliers
2025-11-04 02:18:36 - src.anomaly_detector.GeographicAnomalyDetector - INFO - Detected 5274 cluster outliers
2025-11-04 02:18:36 - src.anomaly_detector.GeographicAnomalyDetector - INFO - Municipality classification: {'urban': 2242, 'rural': 639, 'unknown': 220}
2025-11-04 02:18:36 - src.anomaly_detector.GeographicAnomalyDetector - INFO - Detected 1223 urban/rural anomalies
2025-11-04 02:18:36 - src.anomaly_detector.GeographicAnomalyDetector - INFO - Total unique geographic anomalies detected: 7154
2025-11-04 02:18:36 - src.detector_manager.DetectorManager - INFO - ✓ geographic completed successfully: 7154 anomalies detected in 3.89s
2025-11-04 02:18:36 - src.detector_manager.DetectorManager - INFO - Running logical detector...
2025-11-04 02:18:36 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Starting logical consistency checking
2025-11-04 02:18:36 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Detected 0 negative value anomalies
2025-11-04 02:18:36 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Detected 0 impossible ratio anomalies
2025-11-04 02:18:36 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Detected 3628 contradictory indicator anomalies
2025-11-04 02:18:36 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Detected 113 unusual missing data pattern anomalies
2025-11-04 02:18:36 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Found 73 municipalities with >70.0% missing indicators
2025-11-04 02:18:36 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Detected 73 municipalities with high missing indicators
2025-11-04 02:18:36 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Detected 615 duplicate identifier anomalies
2025-11-04 02:18:37 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Total unique logical inconsistencies detected: 4013
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO - ✓ logical completed successfully: 4013 anomalies detected in 0.53s
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO - ================================================================================
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO - DETECTOR EXECUTION SUMMARY
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO - ================================================================================
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO - Total detectors: 5
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO - Successful: 5
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO - Failed: 0
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO - Total anomalies detected: 19908
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO - Total execution time: 11.64s
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO - 
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO - Individual Detector Statistics:
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO -   ✓ statistical: 5898 anomalies, 0.66s
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO -   ✓ cross_source: 2843 anomalies, 0.10s
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO -   ✓ temporal: 0 anomalies, 6.45s
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO -   ✓ geographic: 7154 anomalies, 3.89s
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO -   ✓ logical: 4013 anomalies, 0.53s
2025-11-04 02:18:37 - src.detector_manager.DetectorManager - INFO - ================================================================================
2025-11-04 02:18:37 - __main__ - INFO - Detector execution times summary
2025-11-04 02:18:37 - __main__ - INFO - statistical detector completed successfully
2025-11-04 02:18:37 - __main__ - INFO - cross_source detector completed successfully
2025-11-04 02:18:37 - __main__ - INFO - temporal detector completed successfully
2025-11-04 02:18:37 - __main__ - INFO - geographic detector completed successfully
2025-11-04 02:18:37 - __main__ - INFO - logical detector completed successfully
2025-11-04 02:18:37 - __main__ - INFO - ================================================================================
2025-11-04 02:18:37 - __main__ - INFO - Step 3: Aggregating results...
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Combining anomalies from 4 detectors
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Detector 1: 5898 anomalies
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Detector 2: 2843 anomalies
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Detector 3: 7154 anomalies
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Detector 4: 4013 anomalies
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Combined total: 19908 anomalies before deduplication
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - After deduplication: 16682 unique anomalies
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Sorted anomalies by severity_score
2025-11-04 02:18:37 - __main__ - INFO - Combined anomalies from all detectors
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Calculating priority scores for all anomalies
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Priority scores calculated for 16682 anomalies
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Priority score range: 33.00 - 130.00
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Mean priority score: 77.86
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Highest priority anomaly: Самара - population_female (statistical_outlier) - Priority: 130.00
2025-11-04 02:18:37 - __main__ - INFO - Added priority scores to anomalies
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Calculating municipality-level anomaly scores
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Calculated scores for 2659 municipalities
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Top municipality: Пресненский with 44 anomalies and total severity score 3708.50
2025-11-04 02:18:37 - __main__ - INFO - Calculated municipality scores
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Ranking anomalies by priority
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Ranked 16682 anomalies using priority_score
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Priority Score range: 33.00 - 130.00
2025-11-04 02:18:37 - __main__ - INFO - Ranked anomalies by severity
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Categorizing anomalies by type
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Category 'statistical_outliers': 4804 anomalies
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Category 'cross_source_discrepancies': 2414 anomalies
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Category 'logical_inconsistencies': 4013 anomalies
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Category 'geographic_anomalies': 5451 anomalies
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Category 'temporal_anomalies': 0 anomalies (empty)
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Category 'data_quality_issues': 0 anomalies (empty)
2025-11-04 02:18:37 - __main__ - INFO - Categorized anomalies by type
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Calculating summary statistics
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Summary: 16682 total anomalies affecting 2659 municipalities
2025-11-04 02:18:37 - __main__ - INFO - Generated summary statistics
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Calculating detection metrics
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Anomalies by type: {'geographic_anomaly': 5451, 'statistical_outlier': 4804, 'logical_inconsistency': 4013, 'cross_source_discrepancy': 2414}
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Anomalies by severity: {'critical': 4586, 'high': 8669, 'medium': 3304, 'low': 123}
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Municipalities affected: 2659
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Percentage of municipalities affected: 85.75%
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Anomaly rate per 1000 municipalities: 5379.55
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Anomaly rate per 1000 by type: {'geographic_anomaly': 1757.82, 'statistical_outlier': 1549.18, 'logical_inconsistency': 1294.1, 'cross_source_discrepancy': 778.46}
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Average anomalies per affected municipality: 6.27
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Detection metrics calculated
2025-11-04 02:18:37 - __main__ - INFO - Calculated detection metrics
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Checking anomaly count warnings
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - WARNING - High anomaly count detected: 16682 (expected: 10-5000)
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Municipalities affected above optimal: 85.8% (optimal: <50.0%)
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - WARNING - High anomaly rate: 5379.6 per 1000 (expected: <5000)
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - WARNING - Generated 3 anomaly count warnings
2025-11-04 02:18:37 - __main__ - INFO - Anomaly count warnings generated
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Calculating data quality metrics
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Overall data completeness: 84.12%
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - WARNING - Found 2 indicators with <50% completeness
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Missing values: 17729 (15.88%)
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - WARNING - Found 879 duplicate records
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Consistency score: 85.14% (duplicate: 71.65%, completeness: 84.12%, logical: 100.00%)
2025-11-04 02:18:37 - src.results_aggregator.ResultsAggregator - INFO - Overall data quality grade: C (score: 84.63%)
2025-11-04 02:18:37 - __main__ - INFO - Calculated data quality metrics
2025-11-04 02:18:37 - __main__ - INFO - Aggregation completed
2025-11-04 02:18:37 - __main__ - INFO - ================================================================================
2025-11-04 02:18:37 - __main__ - INFO - Step 4: Exporting results...
2025-11-04 02:18:37 - src.exporter.ResultsExporter - INFO - Output directory: output
2025-11-04 02:18:37 - src.exporter.ResultsExporter - INFO - Exporting master anomalies CSV
2025-11-04 02:18:37 - src.exporter.ResultsExporter - INFO - Exported 16682 anomalies to output\anomalies_master_20251104_021837.csv
2025-11-04 02:18:37 - src.exporter.ResultsExporter - INFO - File size: 6113.76 KB
2025-11-04 02:18:37 - __main__ - INFO - Master CSV exported successfully
2025-11-04 02:18:37 - src.exporter.ResultsExporter - INFO - Exporting summary Excel with multiple sheets
2025-11-04 02:18:37 - src.exporter.ResultsExporter - INFO - Creating Executive Summary sheet
2025-11-04 02:18:37 - src.exporter.ExecutiveSummaryGenerator - INFO - Generating executive summary
2025-11-04 02:18:37 - src.exporter.ExecutiveSummaryGenerator - INFO - Identifying top 10 municipalities by risk
2025-11-04 02:18:38 - src.exporter.ExecutiveSummaryGenerator - INFO - Identified top 10 municipalities from 2665 total
2025-11-04 02:18:38 - src.exporter.ExecutiveSummaryGenerator - INFO - Generating key findings
2025-11-04 02:18:38 - src.exporter.ExecutiveSummaryGenerator - INFO - Generated 7 key findings
2025-11-04 02:18:38 - src.exporter.ExecutiveSummaryGenerator - INFO - Generating recommendations
2025-11-04 02:18:38 - src.exporter.ExecutiveSummaryGenerator - INFO - Generated 6 recommendations
2025-11-04 02:18:38 - src.exporter.ExecutiveSummaryGenerator - INFO - Executive summary generated: 16682 anomalies, 3657 critical, 2659 municipalities affected
2025-11-04 02:18:38 - src.exporter.ResultsExporter - INFO - Executive Summary sheet created with formatting
2025-11-04 02:18:38 - src.exporter.ResultsExporter - INFO - Creating Overview sheet
2025-11-04 02:18:38 - src.exporter.ResultsExporter - INFO - Overview sheet created
2025-11-04 02:18:38 - src.exporter.ResultsExporter - INFO - Creating anomaly type sheets
2025-11-04 02:18:38 - src.exporter.ResultsExporter - INFO - Created sheet: Statistical_Outliers with 4804 anomalies
2025-11-04 02:18:38 - src.exporter.ResultsExporter - INFO - Created empty sheet: Temporal_Anomalies
2025-11-04 02:18:39 - src.exporter.ResultsExporter - INFO - Created sheet: Geographic_Anomalies with 5451 anomalies
2025-11-04 02:18:39 - src.exporter.ResultsExporter - INFO - Created sheet: Cross_Source_Discrepancies with 2414 anomalies
2025-11-04 02:18:39 - src.exporter.ResultsExporter - INFO - Created sheet: Logical_Inconsistencies with 4013 anomalies
2025-11-04 02:18:39 - src.exporter.ResultsExporter - INFO - Created empty sheet: Data_Quality_Issues
2025-11-04 02:18:39 - src.exporter.ResultsExporter - INFO - Creating Top Anomalous Municipalities sheet
2025-11-04 02:18:39 - src.exporter.ResultsExporter - INFO - Created Top Anomalous Municipalities sheet with 50 entries
2025-11-04 02:18:39 - src.exporter.ResultsExporter - INFO - Creating Data Dictionary sheet
2025-11-04 02:18:39 - src.exporter.ResultsExporter - INFO - Data Dictionary sheet created
2025-11-04 02:18:41 - src.exporter.ResultsExporter - INFO - Exported Excel summary to output\anomalies_summary_20251104_021837.xlsx
2025-11-04 02:18:41 - src.exporter.ResultsExporter - INFO - File size: 1533.71 KB
2025-11-04 02:18:41 - __main__ - INFO - Summary Excel exported successfully
2025-11-04 02:18:41 - src.exporter.ResultsExporter - INFO - Generating visualizations
2025-11-04 02:18:41 - src.exporter.ResultsExporter - INFO - Creating anomaly type distribution chart
2025-11-04 02:18:42 - src.exporter.ResultsExporter - INFO - Saved anomaly type distribution chart to output\viz_20251104_021841_anomaly_type_distribution.png
2025-11-04 02:18:42 - src.exporter.ResultsExporter - INFO - Creating top municipalities chart
2025-11-04 02:18:42 - src.exporter.ResultsExporter - INFO - Saved top municipalities chart to output\viz_20251104_021841_top_municipalities.png
2025-11-04 02:18:42 - src.exporter.ResultsExporter - INFO - Creating geographic heatmap
2025-11-04 02:18:43 - src.exporter.ResultsExporter - INFO - Saved geographic heatmap to output\viz_20251104_021841_geographic_heatmap.png
2025-11-04 02:18:43 - src.exporter.ResultsExporter - INFO - Creating severity distribution histogram
2025-11-04 02:18:43 - src.exporter.ResultsExporter - INFO - Saved severity distribution histogram to output\viz_20251104_021841_severity_distribution.png
2025-11-04 02:18:43 - src.exporter.ResultsExporter - INFO - Generated 4 visualizations
2025-11-04 02:18:43 - __main__ - INFO - Visualizations generated successfully
2025-11-04 02:18:43 - src.exporter.ResultsExporter - INFO - Creating dashboard summary visualization
2025-11-04 02:18:44 - src.exporter.ResultsExporter - INFO - Saved dashboard summary to output\dashboard_summary_20251104_021843.png
2025-11-04 02:18:44 - __main__ - INFO - Dashboard summary generated successfully
2025-11-04 02:18:44 - src.exporter.ResultsExporter - INFO - Generating methodology document
2025-11-04 02:18:44 - src.exporter.ResultsExporter - INFO - Generated methodology document: output\methodology_20251104_021844.md
2025-11-04 02:18:44 - __main__ - INFO - Methodology document generated
2025-11-04 02:18:44 - src.exporter.ResultsExporter - INFO - Generating example cases document
2025-11-04 02:18:44 - src.exporter.ResultsExporter - INFO - Generated example cases document: output\example_cases_20251104_021844.md
2025-11-04 02:18:44 - __main__ - INFO - Example cases generated
2025-11-04 02:18:44 - src.exporter.ResultsExporter - INFO - Generating README document
2025-11-04 02:18:44 - __main__ - ERROR - Error generating README
Traceback (most recent call last):
  File "C:\Jack\code\softi\sber\main.py", line 1300, in main
    readme_path = exporter.generate_readme(summary_stats, config)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Jack\code\softi\sber\src\exporter.py", line 2092, in generate_readme
    filename_only = os.path.basename(file_path)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen ntpath>", line 270, in basename
  File "<frozen ntpath>", line 241, in split
TypeError: expected str, bytes or os.PathLike object, not dict
2025-11-04 02:18:44 - __main__ - INFO - ================================================================================
2025-11-04 02:18:44 - __main__ - INFO - Step 5: Validating output files...
2025-11-04 02:18:44 - __main__ - INFO - Validating output files...
2025-11-04 02:18:44 - __main__ - INFO - ✓ Found 1 master CSV file(s)
2025-11-04 02:18:44 - __main__ - INFO - ✓ Found 1 summary Excel file(s)
2025-11-04 02:18:44 - __main__ - INFO - ✓ Found 4 visualization file(s)
2025-11-04 02:18:44 - __main__ - WARNING - ✗ No documentation files found
2025-11-04 02:18:44 - __main__ - INFO - ✓ Log file exists: output\anomaly_detection.log
2025-11-04 02:18:44 - __main__ - WARNING - Some expected output files are missing
2025-11-04 02:18:44 - __main__ - WARNING - Some output files may be missing
2025-11-04 02:18:44 - __main__ - INFO - ================================================================================
2025-11-04 02:18:44 - __main__ - INFO - PIPELINE EXECUTION SUMMARY
2025-11-04 02:18:44 - __main__ - INFO - ================================================================================
2025-11-04 02:18:44 - __main__ - INFO - Pipeline execution completed
2025-11-04 02:18:44 - __main__ - INFO - Start time: 2025-11-04 02:18:16
2025-11-04 02:18:44 - __main__ - INFO - End time: 2025-11-04 02:18:44
2025-11-04 02:18:44 - __main__ - INFO - Total execution time: 0:00:27.649666
2025-11-04 02:18:44 - __main__ - INFO - 
2025-11-04 02:18:44 - __main__ - INFO - Steps completed: data_loading, auto_tuning, anomaly_detection, aggregation, export
2025-11-04 02:18:44 - __main__ - INFO - 
2025-11-04 02:18:44 - __main__ - INFO - Data Loading Summary:
2025-11-04 02:18:44 - __main__ - INFO -   - sberindex: {'connection': 4761495, 'consumption': 303126, 'market_access': 2571}
2025-11-04 02:18:44 - __main__ - INFO -   - rosstat: {'population': 700215, 'migration': 106224, 'salary': 369812}
2025-11-04 02:18:44 - __main__ - INFO -   - municipal_dict: 3101
2025-11-04 02:18:44 - __main__ - INFO -   - unified: {'municipalities': 3101, 'indicators': 36, 'completeness': 0.84118922211473}
2025-11-04 02:18:44 - __main__ - INFO - 
2025-11-04 02:18:44 - __main__ - INFO - Anomaly Detection Summary:
2025-11-04 02:18:44 - __main__ - INFO -   - statistical: 5898 anomalies
2025-11-04 02:18:44 - __main__ - INFO -   - cross_source: 2843 anomalies
2025-11-04 02:18:44 - __main__ - INFO -   - temporal: 0 anomalies
2025-11-04 02:18:44 - __main__ - INFO -   - geographic: 7154 anomalies
2025-11-04 02:18:44 - __main__ - INFO -   - logical: 4013 anomalies
2025-11-04 02:18:44 - __main__ - INFO -   - Total anomalies: 16682
2025-11-04 02:18:44 - __main__ - INFO - 
2025-11-04 02:18:44 - __main__ - INFO - Files exported: 11
2025-11-04 02:18:44 - __main__ - INFO - 
2025-11-04 02:18:44 - __main__ - INFO - Warnings (7):
2025-11-04 02:18:44 - __main__ - WARNING -   - Duplicate territory_ids: 879
2025-11-04 02:18:44 - __main__ - WARNING -   - Missing values: 17729 in 32 columns
2025-11-04 02:18:44 - __main__ - WARNING -   - Слишком много аномалий обнаружено: 16682
2025-11-04 02:18:44 - __main__ - WARNING -   - Высокий процент муниципалитетов с аномалиями: 85.8%
2025-11-04 02:18:44 - __main__ - WARNING -   - Очень высокая частота аномалий: 5379.6 на 1000 муниципалитетов
2025-11-04 02:18:44 - __main__ - WARNING -   - README generation failed: expected str, bytes or os.PathLike object, not dict
2025-11-04 02:18:44 - __main__ - WARNING -   - Some output files missing
2025-11-04 02:18:44 - __main__ - INFO - 
2025-11-04 02:18:44 - __main__ - INFO - ================================================================================
2025-11-04 02:18:44 - __main__ - INFO - Pipeline completed successfully
2025-11-04 02:28:36 - __main__ - INFO - Logging configured
2025-11-04 02:28:36 - __main__ - INFO - Starting anomaly detection pipeline
2025-11-04 02:28:36 - __main__ - INFO - Configuration loaded from config.yaml
2025-11-04 02:28:38 - __main__ - INFO - All components imported successfully
2025-11-04 02:28:38 - __main__ - INFO - ================================================================================
2025-11-04 02:28:38 - __main__ - INFO - Step 1: Loading data...
2025-11-04 02:28:38 - src.data_loader - INFO - DataLoader initialized with base path: .
2025-11-04 02:28:38 - src.data_loader - INFO - Loading СберИндекс data...
2025-11-04 02:28:38 - src.data_loader - INFO - Loaded connection: 4761495 rows, 4 columns
2025-11-04 02:28:38 - src.data_loader - INFO - Loaded consumption: 303126 rows, 4 columns
2025-11-04 02:28:38 - src.data_loader - INFO - Loaded market_access: 2571 rows, 2 columns
2025-11-04 02:28:38 - __main__ - INFO - СберИндекс data loaded successfully
2025-11-04 02:28:38 - src.data_loader - INFO - Loading Росстат data...
2025-11-04 02:28:38 - src.data_loader - INFO - Loaded population: 700215 rows, 6 columns
2025-11-04 02:28:38 - src.data_loader - INFO - Loaded migration: 106224 rows, 6 columns
2025-11-04 02:28:38 - src.data_loader - INFO - Loaded salary: 369812 rows, 6 columns
2025-11-04 02:28:38 - __main__ - INFO - Росстат data loaded successfully
2025-11-04 02:28:38 - src.data_loader - INFO - Loading municipal dictionary...
2025-11-04 02:28:38 - src.data_loader - INFO - Loaded municipal dictionary: 3101 rows, 18 columns
2025-11-04 02:28:38 - __main__ - INFO - Municipal dictionary loaded
2025-11-04 02:28:38 - src.data_loader - INFO - Merging datasets...
2025-11-04 02:28:38 - src.data_loader - INFO - Starting with 3101 municipalities from dictionary
2025-11-04 02:28:38 - src.data_loader - INFO - Merged consumption data: 6 categories
2025-11-04 02:28:38 - src.data_loader - INFO - Merged market access data
2025-11-04 02:28:38 - src.data_loader - INFO - Merged population data
2025-11-04 02:28:38 - src.data_loader - INFO - Merged migration data
2025-11-04 02:28:38 - src.data_loader - INFO - Merged salary data: 21 industries
2025-11-04 02:28:38 - src.data_loader - INFO - Final merged dataset: 3101 rows, 36 columns
2025-11-04 02:28:38 - src.data_loader - INFO - Validating data quality...
2025-11-04 02:28:38 - src.data_loader - WARNING - Found missing values in 32 columns
2025-11-04 02:28:38 - src.data_loader - WARNING -   salary_Деятельность экстер. организаций: 3095 missing values (99.8%)
2025-11-04 02:28:38 - src.data_loader - WARNING -   salary_Добыча полезных ископаемых: 2139 missing values (69.0%)
2025-11-04 02:28:38 - src.data_loader - WARNING -   salary_Прочие услуги: 1337 missing values (43.1%)
2025-11-04 02:28:38 - src.data_loader - WARNING -   salary_Гостиницы и общепит: 979 missing values (31.6%)
2025-11-04 02:28:38 - src.data_loader - WARNING -   salary_Строительство: 961 missing values (31.0%)
2025-11-04 02:28:38 - src.data_loader - WARNING -   salary_Операции с недвижимостью: 793 missing values (25.6%)
2025-11-04 02:28:38 - src.data_loader - WARNING -   salary_Водоснабжение: 684 missing values (22.1%)
2025-11-04 02:28:38 - src.data_loader - WARNING -   salary_Обрабатывающие производства: 634 missing values (20.4%)
2025-11-04 02:28:38 - src.data_loader - WARNING -   salary_Сельское хозяйство: 598 missing values (19.3%)
2025-11-04 02:28:38 - src.data_loader - WARNING -   consumption_Все категории: 495 missing values (16.0%)
2025-11-04 02:28:38 - src.data_loader - WARNING - Found 2 columns with >50% missing values - consider excluding from analysis
2025-11-04 02:28:38 - src.data_loader - WARNING - Found 438 duplicate territory_ids
2025-11-04 02:28:38 - src.data_loader - INFO - Average data completeness: 83.67%
2025-11-04 02:28:38 - src.data_loader - WARNING - Found 105 municipalities with <50% data completeness
2025-11-04 02:28:38 - src.data_loader - INFO - Validation complete: 3101 rows, 36 columns, 84.12% overall completeness
2025-11-04 02:28:38 - src.data_loader - INFO - Creating source mapping for 36 columns...
2025-11-04 02:28:38 - src.data_loader - INFO - Source mapping complete: {'municipal_dict': 4, 'sberindex': 7, 'rosstat': 25}
2025-11-04 02:28:38 - __main__ - INFO - Created source mapping for columns
2025-11-04 02:28:38 - src.data_loader - INFO - Detecting duplicate territory_ids...
2025-11-04 02:28:38 - src.data_loader - WARNING - Found 879 duplicate territory_id entries affecting 438 territories
2025-11-04 02:28:38 - src.data_loader - INFO - Analyzing temporal structure...
2025-11-04 02:28:38 - src.data_loader - INFO - Periods per territory - Min: 1, Max: 3, Avg: 1.2
2025-11-04 02:28:38 - src.data_loader - INFO - Found 438 territories with multiple time periods
2025-11-04 02:28:38 - src.data_loader - INFO - No temporal structure detected in dataset
2025-11-04 02:28:38 - src.data_loader - INFO - Duplicate analysis (sample): 0 identical, 20 different
2025-11-04 02:28:38 - src.data_loader - WARNING - Duplicates have different values without temporal structure - investigate data quality
2025-11-04 02:28:38 - src.data_loader - INFO - Duplicate detection complete: is_temporal=False, recommendation='investigate'
2025-11-04 02:28:38 - __main__ - WARNING - DATA QUALITY WARNING: Found 879 duplicate territory_id entries
2025-11-04 02:28:38 - __main__ - WARNING - DATA QUALITY WARNING: Missing values detected in 32 columns
2025-11-04 02:28:38 - __main__ - INFO - Data merged successfully
2025-11-04 02:28:38 - __main__ - INFO - ================================================================================
2025-11-04 02:28:38 - __main__ - INFO - Step 2: Running anomaly detectors...
2025-11-04 02:28:38 - __main__ - INFO - Auto-tuning is enabled - running threshold optimization before detection
2025-11-04 02:28:38 - src.auto_tuner.AutoTuner - INFO - Loaded 1 historical tuning records
2025-11-04 02:28:38 - src.auto_tuner.AutoTuner - INFO - AutoTuner initialized: target_fpr=0.05, strategy=adaptive
2025-11-04 02:28:38 - src.auto_tuner.AutoTuner - INFO - Checking if periodic re-tuning is needed
2025-11-04 02:28:38 - __main__ - INFO - Auto-tuning skipped: Re-tuning not needed (30 days until next scheduled tuning)
2025-11-04 02:28:38 - src.detector_manager.ThresholdManager - INFO - Profile 'relaxed' loaded and validated successfully
2025-11-04 02:28:38 - src.detector_manager.ThresholdManager - INFO - ThresholdManager initialized with profile: relaxed
2025-11-04 02:28:38 - src.detector_manager.DetectorManager - INFO - DetectorManager initialized with 5 detectors using profile 'relaxed'
2025-11-04 02:28:38 - src.detector_manager.DetectorManager - INFO - ================================================================================
2025-11-04 02:28:38 - src.detector_manager.DetectorManager - INFO - Starting detector execution
2025-11-04 02:28:38 - src.detector_manager.DetectorManager - INFO - Input data shape: (3101, 36)
2025-11-04 02:28:38 - src.detector_manager.DetectorManager - INFO - ================================================================================
2025-11-04 02:28:38 - src.detector_manager.DetectorManager - INFO - Running statistical detector...
2025-11-04 02:28:38 - src.anomaly_detector.StatisticalOutlierDetector - INFO - Starting statistical outlier detection
2025-11-04 02:28:38 - src.anomaly_detector.StatisticalOutlierDetector - INFO - Z-score method detected 700 anomalies
2025-11-04 02:28:39 - src.anomaly_detector.StatisticalOutlierDetector - INFO - IQR method detected 4737 anomalies
2025-11-04 02:28:39 - src.anomaly_detector.StatisticalOutlierDetector - INFO - Percentile method detected 849 anomalies
2025-11-04 02:28:39 - src.anomaly_detector.StatisticalOutlierDetector - INFO - Total unique statistical outliers detected: 5898
2025-11-04 02:28:39 - src.detector_manager.DetectorManager - INFO - ✓ statistical completed successfully: 5898 anomalies detected in 0.69s
2025-11-04 02:28:39 - src.detector_manager.DetectorManager - INFO - Running cross_source detector...
2025-11-04 02:28:39 - src.anomaly_detector.CrossSourceComparator - INFO - Starting cross-source comparison detection
2025-11-04 02:28:39 - src.anomaly_detector.CrossSourceComparator - WARNING - Low correlation (0.156) between market_access and population_total
2025-11-04 02:28:39 - src.anomaly_detector.CrossSourceComparator - INFO - Calculated correlations for 1 indicator pairs
2025-11-04 02:28:39 - src.anomaly_detector.CrossSourceComparator - INFO - Detected 2843 large discrepancies
2025-11-04 02:28:39 - src.anomaly_detector.CrossSourceComparator - INFO - Total cross-source anomalies detected: 2843
2025-11-04 02:28:39 - src.detector_manager.DetectorManager - INFO - ✓ cross_source completed successfully: 2843 anomalies detected in 0.10s
2025-11-04 02:28:39 - src.detector_manager.DetectorManager - INFO - Running temporal detector...
2025-11-04 02:28:39 - src.anomaly_detector.TemporalAnomalyDetector - INFO - Starting temporal anomaly detection
2025-11-04 02:28:45 - src.anomaly_detector.TemporalAnomalyDetector - INFO - Detected 0 sudden spikes
2025-11-04 02:28:45 - src.anomaly_detector.TemporalAnomalyDetector - INFO - Detected 0 trend reversals
2025-11-04 02:28:46 - src.anomaly_detector.TemporalAnomalyDetector - INFO - Detected 0 high volatility cases
2025-11-04 02:28:46 - src.anomaly_detector.TemporalAnomalyDetector - INFO - Detected 0 seasonal anomalies
2025-11-04 02:28:46 - src.anomaly_detector.TemporalAnomalyDetector - INFO - No temporal anomalies detected
2025-11-04 02:28:46 - src.detector_manager.DetectorManager - INFO - ✓ temporal completed successfully: 0 anomalies detected in 7.13s
2025-11-04 02:28:46 - src.detector_manager.DetectorManager - INFO - Running geographic detector...
2025-11-04 02:28:46 - src.anomaly_detector.GeographicAnomalyDetector - INFO - Starting geographic anomaly detection
2025-11-04 02:28:46 - src.anomaly_detector.GeographicAnomalyDetector - WARNING - No municipality_type column - falling back to region-only grouping
2025-11-04 02:28:48 - src.anomaly_detector.GeographicAnomalyDetector - INFO - Detected 1310 regional outliers
2025-11-04 02:28:49 - src.anomaly_detector.GeographicAnomalyDetector - INFO - Detected 5274 cluster outliers
2025-11-04 02:28:49 - src.anomaly_detector.GeographicAnomalyDetector - INFO - Municipality classification: {'urban': 2242, 'rural': 639, 'unknown': 220}
2025-11-04 02:28:49 - src.anomaly_detector.GeographicAnomalyDetector - INFO - Detected 1223 urban/rural anomalies
2025-11-04 02:28:50 - src.anomaly_detector.GeographicAnomalyDetector - INFO - Total unique geographic anomalies detected: 7154
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - ✓ geographic completed successfully: 7154 anomalies detected in 3.18s
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - Running logical detector...
2025-11-04 02:28:50 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Starting logical consistency checking
2025-11-04 02:28:50 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Detected 0 negative value anomalies
2025-11-04 02:28:50 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Detected 0 impossible ratio anomalies
2025-11-04 02:28:50 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Detected 3628 contradictory indicator anomalies
2025-11-04 02:28:50 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Detected 113 unusual missing data pattern anomalies
2025-11-04 02:28:50 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Found 73 municipalities with >70.0% missing indicators
2025-11-04 02:28:50 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Detected 73 municipalities with high missing indicators
2025-11-04 02:28:50 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Detected 615 duplicate identifier anomalies
2025-11-04 02:28:50 - src.anomaly_detector.LogicalConsistencyChecker - INFO - Total unique logical inconsistencies detected: 4013
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - ✓ logical completed successfully: 4013 anomalies detected in 0.47s
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - ================================================================================
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - DETECTOR EXECUTION SUMMARY
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - ================================================================================
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - Total detectors: 5
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - Successful: 5
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - Failed: 0
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - Total anomalies detected: 19908
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - Total execution time: 11.57s
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - 
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - Individual Detector Statistics:
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO -   ✓ statistical: 5898 anomalies, 0.69s
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO -   ✓ cross_source: 2843 anomalies, 0.10s
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO -   ✓ temporal: 0 anomalies, 7.13s
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO -   ✓ geographic: 7154 anomalies, 3.18s
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO -   ✓ logical: 4013 anomalies, 0.47s
2025-11-04 02:28:50 - src.detector_manager.DetectorManager - INFO - ================================================================================
2025-11-04 02:28:50 - __main__ - INFO - Detector execution times summary
2025-11-04 02:28:50 - __main__ - INFO - statistical detector completed successfully
2025-11-04 02:28:50 - __main__ - INFO - cross_source detector completed successfully
2025-11-04 02:28:50 - __main__ - INFO - temporal detector completed successfully
2025-11-04 02:28:50 - __main__ - INFO - geographic detector completed successfully
2025-11-04 02:28:50 - __main__ - INFO - logical detector completed successfully
2025-11-04 02:28:50 - __main__ - INFO - ================================================================================
2025-11-04 02:28:50 - __main__ - INFO - Step 3: Aggregating results...
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Combining anomalies from 4 detectors
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Detector 1: 5898 anomalies
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Detector 2: 2843 anomalies
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Detector 3: 7154 anomalies
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Detector 4: 4013 anomalies
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Combined total: 19908 anomalies before deduplication
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - After deduplication: 16682 unique anomalies
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Sorted anomalies by severity_score
2025-11-04 02:28:50 - __main__ - INFO - Combined anomalies from all detectors
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Calculating priority scores for all anomalies
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Priority scores calculated for 16682 anomalies
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Priority score range: 33.00 - 130.00
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Mean priority score: 77.86
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Highest priority anomaly: Самара - population_female (statistical_outlier) - Priority: 130.00
2025-11-04 02:28:50 - __main__ - INFO - Added priority scores to anomalies
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Calculating municipality-level anomaly scores
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Calculated scores for 2659 municipalities
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Top municipality: Пресненский with 44 anomalies and total severity score 3708.50
2025-11-04 02:28:50 - __main__ - INFO - Calculated municipality scores
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Ranking anomalies by priority
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Ranked 16682 anomalies using priority_score
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Priority Score range: 33.00 - 130.00
2025-11-04 02:28:50 - __main__ - INFO - Ranked anomalies by severity
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Categorizing anomalies by type
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Category 'statistical_outliers': 4804 anomalies
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Category 'cross_source_discrepancies': 2414 anomalies
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Category 'logical_inconsistencies': 4013 anomalies
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Category 'geographic_anomalies': 5451 anomalies
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Category 'temporal_anomalies': 0 anomalies (empty)
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Category 'data_quality_issues': 0 anomalies (empty)
2025-11-04 02:28:50 - __main__ - INFO - Categorized anomalies by type
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Calculating summary statistics
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Summary: 16682 total anomalies affecting 2659 municipalities
2025-11-04 02:28:50 - __main__ - INFO - Generated summary statistics
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Calculating detection metrics
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Anomalies by type: {'geographic_anomaly': 5451, 'statistical_outlier': 4804, 'logical_inconsistency': 4013, 'cross_source_discrepancy': 2414}
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Anomalies by severity: {'critical': 4586, 'high': 8669, 'medium': 3304, 'low': 123}
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Municipalities affected: 2659
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Percentage of municipalities affected: 85.75%
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Anomaly rate per 1000 municipalities: 5379.55
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Anomaly rate per 1000 by type: {'geographic_anomaly': 1757.82, 'statistical_outlier': 1549.18, 'logical_inconsistency': 1294.1, 'cross_source_discrepancy': 778.46}
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Average anomalies per affected municipality: 6.27
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Detection metrics calculated
2025-11-04 02:28:50 - __main__ - INFO - Calculated detection metrics
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Checking anomaly count warnings
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - WARNING - High anomaly count detected: 16682 (expected: 10-5000)
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Municipalities affected above optimal: 85.8% (optimal: <50.0%)
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - WARNING - High anomaly rate: 5379.6 per 1000 (expected: <5000)
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - WARNING - Generated 3 anomaly count warnings
2025-11-04 02:28:50 - __main__ - INFO - Anomaly count warnings generated
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Calculating data quality metrics
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Overall data completeness: 84.12%
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - WARNING - Found 2 indicators with <50% completeness
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Missing values: 17729 (15.88%)
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - WARNING - Found 879 duplicate records
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Consistency score: 85.14% (duplicate: 71.65%, completeness: 84.12%, logical: 100.00%)
2025-11-04 02:28:50 - src.results_aggregator.ResultsAggregator - INFO - Overall data quality grade: C (score: 84.63%)
2025-11-04 02:28:50 - __main__ - INFO - Calculated data quality metrics
2025-11-04 02:28:50 - __main__ - INFO - Aggregation completed
2025-11-04 02:28:50 - __main__ - INFO - ================================================================================
2025-11-04 02:28:50 - __main__ - INFO - Step 4: Exporting results...
2025-11-04 02:28:50 - src.exporter.ResultsExporter - INFO - Output directory: output
2025-11-04 02:28:50 - src.exporter.ResultsExporter - INFO - Exporting master anomalies CSV
2025-11-04 02:28:50 - src.exporter.ResultsExporter - INFO - Exported 16682 anomalies to output\anomalies_master_20251104_022850.csv
2025-11-04 02:28:50 - src.exporter.ResultsExporter - INFO - File size: 6113.76 KB
2025-11-04 02:28:50 - __main__ - INFO - Master CSV exported successfully
2025-11-04 02:28:50 - src.exporter.ResultsExporter - INFO - Exporting summary Excel with multiple sheets
2025-11-04 02:28:50 - src.exporter.ResultsExporter - INFO - Creating Executive Summary sheet
2025-11-04 02:28:50 - src.exporter.ExecutiveSummaryGenerator - INFO - Generating executive summary
2025-11-04 02:28:50 - src.exporter.ExecutiveSummaryGenerator - INFO - Identifying top 10 municipalities by risk
2025-11-04 02:28:51 - src.exporter.ExecutiveSummaryGenerator - INFO - Identified top 10 municipalities from 2665 total
2025-11-04 02:28:51 - src.exporter.ExecutiveSummaryGenerator - INFO - Generating key findings
2025-11-04 02:28:51 - src.exporter.ExecutiveSummaryGenerator - INFO - Generated 7 key findings
2025-11-04 02:28:51 - src.exporter.ExecutiveSummaryGenerator - INFO - Generating recommendations
2025-11-04 02:28:51 - src.exporter.ExecutiveSummaryGenerator - INFO - Generated 6 recommendations
2025-11-04 02:28:51 - src.exporter.ExecutiveSummaryGenerator - INFO - Executive summary generated: 16682 anomalies, 3657 critical, 2659 municipalities affected
2025-11-04 02:28:51 - src.exporter.ResultsExporter - INFO - Executive Summary sheet created with formatting
2025-11-04 02:28:51 - src.exporter.ResultsExporter - INFO - Creating Overview sheet
2025-11-04 02:28:51 - src.exporter.ResultsExporter - INFO - Overview sheet created
2025-11-04 02:28:51 - src.exporter.ResultsExporter - INFO - Creating anomaly type sheets
2025-11-04 02:28:51 - src.exporter.ResultsExporter - INFO - Created sheet: Statistical_Outliers with 4804 anomalies
2025-11-04 02:28:51 - src.exporter.ResultsExporter - INFO - Created empty sheet: Temporal_Anomalies
2025-11-04 02:28:52 - src.exporter.ResultsExporter - INFO - Created sheet: Geographic_Anomalies with 5451 anomalies
2025-11-04 02:28:52 - src.exporter.ResultsExporter - INFO - Created sheet: Cross_Source_Discrepancies with 2414 anomalies
2025-11-04 02:28:52 - src.exporter.ResultsExporter - INFO - Created sheet: Logical_Inconsistencies with 4013 anomalies
2025-11-04 02:28:52 - src.exporter.ResultsExporter - INFO - Created empty sheet: Data_Quality_Issues
2025-11-04 02:28:52 - src.exporter.ResultsExporter - INFO - Creating Top Anomalous Municipalities sheet
2025-11-04 02:28:52 - src.exporter.ResultsExporter - INFO - Created Top Anomalous Municipalities sheet with 50 entries
2025-11-04 02:28:52 - src.exporter.ResultsExporter - INFO - Creating Data Dictionary sheet
2025-11-04 02:28:52 - src.exporter.ResultsExporter - INFO - Data Dictionary sheet created
2025-11-04 02:28:54 - src.exporter.ResultsExporter - INFO - Exported Excel summary to output\anomalies_summary_20251104_022850.xlsx
2025-11-04 02:28:54 - src.exporter.ResultsExporter - INFO - File size: 1533.71 KB
2025-11-04 02:28:54 - __main__ - INFO - Summary Excel exported successfully
2025-11-04 02:28:54 - src.exporter.ResultsExporter - INFO - Generating visualizations
2025-11-04 02:28:54 - src.exporter.ResultsExporter - INFO - Creating anomaly type distribution chart
2025-11-04 02:28:54 - src.exporter.ResultsExporter - INFO - Saved anomaly type distribution chart to output\viz_20251104_022854_anomaly_type_distribution.png
2025-11-04 02:28:54 - src.exporter.ResultsExporter - INFO - Creating top municipalities chart
2025-11-04 02:28:54 - src.exporter.ResultsExporter - INFO - Saved top municipalities chart to output\viz_20251104_022854_top_municipalities.png
2025-11-04 02:28:54 - src.exporter.ResultsExporter - INFO - Creating geographic heatmap
2025-11-04 02:28:55 - src.exporter.ResultsExporter - INFO - Saved geographic heatmap to output\viz_20251104_022854_geographic_heatmap.png
2025-11-04 02:28:55 - src.exporter.ResultsExporter - INFO - Creating severity distribution histogram
2025-11-04 02:28:55 - src.exporter.ResultsExporter - INFO - Saved severity distribution histogram to output\viz_20251104_022854_severity_distribution.png
2025-11-04 02:28:55 - src.exporter.ResultsExporter - INFO - Generated 4 visualizations
2025-11-04 02:28:55 - __main__ - INFO - Visualizations generated successfully
2025-11-04 02:28:55 - src.exporter.ResultsExporter - INFO - Creating dashboard summary visualization
2025-11-04 02:28:55 - src.exporter.ResultsExporter - INFO - Saved dashboard summary to output\dashboard_summary_20251104_022855.png
2025-11-04 02:28:55 - __main__ - INFO - Dashboard summary generated successfully
2025-11-04 02:28:55 - src.exporter.ResultsExporter - INFO - Generating methodology document
2025-11-04 02:28:55 - src.exporter.ResultsExporter - INFO - Generated methodology document: output\methodology_20251104_022855.md
2025-11-04 02:28:55 - __main__ - INFO - Methodology document generated
2025-11-04 02:28:55 - src.exporter.ResultsExporter - INFO - Generating example cases document
2025-11-04 02:28:55 - src.exporter.ResultsExporter - INFO - Generated example cases document: output\example_cases_20251104_022855.md
2025-11-04 02:28:55 - __main__ - INFO - Example cases generated
2025-11-04 02:28:55 - src.exporter.ResultsExporter - INFO - Generating README document
2025-11-04 02:28:55 - __main__ - ERROR - Error generating README
Traceback (most recent call last):
  File "C:\Jack\code\softi\sber\main.py", line 1300, in main
    readme_path = exporter.generate_readme(summary_stats, config)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Jack\code\softi\sber\src\exporter.py", line 2092, in generate_readme
    filename_only = os.path.basename(file_path)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen ntpath>", line 270, in basename
  File "<frozen ntpath>", line 241, in split
TypeError: expected str, bytes or os.PathLike object, not dict
2025-11-04 02:28:55 - __main__ - INFO - ================================================================================
2025-11-04 02:28:55 - __main__ - INFO - Step 5: Validating output files...
2025-11-04 02:28:55 - __main__ - INFO - Validating output files...
2025-11-04 02:28:55 - __main__ - INFO - ✓ Found 2 master CSV file(s)
2025-11-04 02:28:55 - __main__ - INFO - ✓ Found 2 summary Excel file(s)
2025-11-04 02:28:55 - __main__ - INFO - ✓ Found 8 visualization file(s)
2025-11-04 02:28:55 - __main__ - WARNING - ✗ No documentation files found
2025-11-04 02:28:55 - __main__ - INFO - ✓ Log file exists: output\anomaly_detection.log
2025-11-04 02:28:55 - __main__ - WARNING - Some expected output files are missing
2025-11-04 02:28:55 - __main__ - WARNING - Some output files may be missing
2025-11-04 02:28:55 - __main__ - INFO - ================================================================================
2025-11-04 02:28:55 - __main__ - INFO - PIPELINE EXECUTION SUMMARY
2025-11-04 02:28:55 - __main__ - INFO - ================================================================================
2025-11-04 02:28:55 - __main__ - INFO - Pipeline execution completed
2025-11-04 02:28:55 - __main__ - INFO - Start time: 2025-11-04 02:28:36
2025-11-04 02:28:55 - __main__ - INFO - End time: 2025-11-04 02:28:55
2025-11-04 02:28:55 - __main__ - INFO - Total execution time: 0:00:19.033705
2025-11-04 02:28:55 - __main__ - INFO - 
2025-11-04 02:28:55 - __main__ - INFO - Steps completed: data_loading, anomaly_detection, aggregation, export
2025-11-04 02:28:55 - __main__ - INFO - 
2025-11-04 02:28:55 - __main__ - INFO - Data Loading Summary:
2025-11-04 02:28:55 - __main__ - INFO -   - sberindex: {'connection': 4761495, 'consumption': 303126, 'market_access': 2571}
2025-11-04 02:28:55 - __main__ - INFO -   - rosstat: {'population': 700215, 'migration': 106224, 'salary': 369812}
2025-11-04 02:28:55 - __main__ - INFO -   - municipal_dict: 3101
2025-11-04 02:28:55 - __main__ - INFO -   - unified: {'municipalities': 3101, 'indicators': 36, 'completeness': 0.84118922211473}
2025-11-04 02:28:55 - __main__ - INFO - 
2025-11-04 02:28:55 - __main__ - INFO - Anomaly Detection Summary:
2025-11-04 02:28:55 - __main__ - INFO -   - statistical: 5898 anomalies
2025-11-04 02:28:55 - __main__ - INFO -   - cross_source: 2843 anomalies
2025-11-04 02:28:55 - __main__ - INFO -   - temporal: 0 anomalies
2025-11-04 02:28:55 - __main__ - INFO -   - geographic: 7154 anomalies
2025-11-04 02:28:55 - __main__ - INFO -   - logical: 4013 anomalies
2025-11-04 02:28:55 - __main__ - INFO -   - Total anomalies: 16682
2025-11-04 02:28:55 - __main__ - INFO - 
2025-11-04 02:28:55 - __main__ - INFO - Files exported: 9
2025-11-04 02:28:55 - __main__ - INFO - 
2025-11-04 02:28:55 - __main__ - INFO - Warnings (7):
2025-11-04 02:28:55 - __main__ - WARNING -   - Duplicate territory_ids: 879
2025-11-04 02:28:55 - __main__ - WARNING -   - Missing values: 17729 in 32 columns
2025-11-04 02:28:55 - __main__ - WARNING -   - Слишком много аномалий обнаружено: 16682
2025-11-04 02:28:55 - __main__ - WARNING -   - Высокий процент муниципалитетов с аномалиями: 85.8%
2025-11-04 02:28:55 - __main__ - WARNING -   - Очень высокая частота аномалий: 5379.6 на 1000 муниципалитетов
2025-11-04 02:28:55 - __main__ - WARNING -   - README generation failed: expected str, bytes or os.PathLike object, not dict
2025-11-04 02:28:55 - __main__ - WARNING -   - Some output files missing
2025-11-04 02:28:55 - __main__ - INFO - 
2025-11-04 02:28:55 - __main__ - INFO - ================================================================================
2025-11-04 02:28:55 - __main__ - INFO - Pipeline completed successfully
